infoGain %>% hist(breaks = 30, main = "Information Gain Per Feature",
xlab = "Information Gain")
selectedFeatures <- infoGain <= 0.5
message("Total number of retained features: ", sum(selectedFeatures))
minEntropyId <- sapply(sampleFeatureEntropy[selectedFeatures], function(groups) {
names(groups)[which.max(groups)]
})
table(minEntropyId)
sampleFeatureEntropy
minEntropyId <- sapply(sampleFeatureEntropy[selectedFeatures], function(groups) {
names(groups)
})
minEntropyId
minEntropyId <- sapply(sampleFeatureEntropy[selectedFeatures], function(groups) {
names(groups)
}) %>% unlist()
table(minEntropyId)
selectedData <- omanFT[selectedFeatures,]
selectedData
minEntropyId <- sapply(sampleFeatureEntropy[selectedFeatures], function(groups) {
names(groups)[which.min(groups)]
})
table(minEntropyId)
minEntropyId <- sapply(sampleFeatureEntropy[selectedFeatures], function(groups) {
names(groups)[which.min(groups)]
})
minEntropyId
minEntropyId <- sapply(sampleFeatureEntropy[selectedFeatures], function(groups) {
names(groups)[which.min(groups)]
})
table(minEntropyId)
selectedData <- omanFT[selectedFeatures,]
origData <- read.csv(here::here("data/2018-11-22/OM17 compound_measurements_10k_blanks.csv"),
header = T, skip = 5)
minEntropyId
origData
origData
selectedData
selectedData$classifier <- minEntropyId
selectedData
read.csv(here::here("data/2018-11-22/OM17 compound_measurements_10k_blanks.csv"))
read.csv(here::here("data/2018-11-22/OM17 compound_measurements_10k_blanks.csv"),
header = T)
read.csv(here::here("data/2018-11-22/OM17 compound_measurements_10k_blanks.csv"),
header = T, skip = 1)
read.csv(here::here("data/2018-11-22/OM17 compound_measurements_10k_blanks.csv"),
header = T, skip = 4)
read.csv(here::here("data/2018-11-22/OM17compoundIDs.csv"),
header = T, skip = 4)
read.csv(here::here("data/2018-11-22/OM17compoundIDs.csv"),
header = T, skip = 0)
compoundDb <- read.csv(here::here("data/2018-11-22/OM17compoundIDs.csv"),
header = T, skip = 0)
colnames(compoundDb)
paste(compoundDb$m.z, compoundDb$Retention.time..min., sep = "_")
obsFeatures <- paste(signif(compoundDb$m.z),
signif(compoundDb$Retention.time..min., sep = "_"))
obsFeatures <- paste(signif(compoundDb$m.z),
signif(compoundDb$Retention.time..min.), sep = "_")
paste(signif(selectedData$mz),
signif(selectedData$Retention_Time),
sep = "_")
infoFeatures <- paste(signif(selectedData$mz),
signif(selectedData$Retention_Time),
sep = "_")
lapply(infoFeatures, function(curFeat) {
which(curFeat == obsFeatures)
})
infoFeatures
obsFeatures
infoFeatures
obsFeatures
obsFeatures <- paste(signif(compoundDb$m.z),
signif(compoundDb$Retention.time..min. * 60), sep = "_")
obsFeatures
infoFeatures <- paste(signif(selectedData$mz),
signif(selectedData$Retention_Time),
sep = "_")
lapply(infoFeatures, function(curFeat) {
which(curFeat == obsFeatures)
})
matchedFeatures <- lapply(infoFeatures, function(curFeat) {
which(curFeat == obsFeatures)
})
matchedFeatures[[1]]
compoundDb
matchedFeatures
retainRows <- c(8113)
compoundDb[retainRows,] %>%
select(Adducts, Formula, Score, Fragmentation.Score,
Mass.Error..ppm., Description, m.z, Retention.time..min.)
compoundIds <- list()
for(i in seq_along(matchedFeatures)) {
if(length(matchedFeatures[[i]]) == 0) {
next
} else {
retainRows <- matchedFeatures[[i]]
}
compoundIds[[i]] <- compoundDb[retainRows,] %>%
select(Adducts, Formula, Score, Fragmentation.Score,
Mass.Error..ppm., Description, m.z, Retention.time..min.) %>%
mutate(infoRow = i)
}
compoundIds
Reduce(f = rbind, compoundIds)
matchedCompounds <- Reduce(f = rbind, compoundIds)
infoFeatures
obsFeatures
selectedData
write.table(x = matchedCompounds)
write.table(x = matchedCompounds, row.names = F)
write.table(x = matchedCompounds, row.names = F, file = here("data/2019-01-03/highInfoFeatures.txt"))
write.table(x = selectedData, row.names = F, file = here("data/2019-01-03/highInfoFeatures.txt"))
write.table(x = matchedCompounds, row.names = F, file = here("data/2019-01-03/highInfoCpdMatches.txt"))
read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
princomp(pathways)
pathways
library(corrplot)
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
x <- as.matrix(pathways[,-1])
rownames(x) <- pathways$Function
library(corrplot)
corrplot(x)
corrplot(cor(x))
corrplot(cor(t(x)))
corrplot(cor(x))
prcomp(x,scale. = T)
pcs <- prcomp(x,scale. = T)
plot(pcs$x[,1]), pcs$x[,2])
plot(pcs$x[,1], pcs$x[,2])
pcs <- princomp(x,scale. = T)
pcs
pcs <- princomp(scale(x))
pcs
plot(pcs$loadings[,1], pcs$loadings[,2])
library(NMF)
library(NMF)
res <- nmfEstimateRank(as.matrix(x), seq(2,5), method='brunet',
nrun=50,
seed=123456)
nrows(pathways)
nrow(x)
res <- nmfEstimateRank(as.matrix(x), seq(2,5), method='brunet',
nrun=50,
seed=123456)
x
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
x <- as.matrix(pathways[,-1])
x <- scale(x)
rownames(x) <- pathways$Function
library(NMF)
res <- nmfEstimateRank(as.matrix(x), seq(2,5), method='brunet',
nrun=50,
seed=123456)
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
x <- as.matrix(pathways[,-1])
rownames(x) <- pathways$Function
x
library(NMF)
res <- nmfEstimateRank(as.matrix(x), seq(2,5), method='brunet',
nrun=10,
seed=123456)
x
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
x <- as.matrix(pathways[,-1])
rownames(x) <- pathways$Function
x <- x[rowSums(x) > 0]
res <- nmfEstimateRank(as.matrix(x), seq(2,5), method='brunet',
nrun=10,
seed=123456)
is.na(x)
any(is.na(x))
any(is.null(x))
res <- nmfEstimateRank(as.matrix(x), seq(2,5), method='brunet',
nrun=1,
seed=123456)
res <- nmfEstimateRank(x, seq(2,5), method='brunet',
nrun=1,
seed=123456)
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
x <- as.matrix(pathways[,-1])
rownames(x) <- pathways$Function
x <- x[rowSums(x) > 0]
class(x)
class(as.matrix(x))
x
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
x <- as.matrix(pathways[,-1])
rownames(x) <- pathways$Function
x <- x[rowSums(x) > 0,]
x
res <- nmfEstimateRank(x, seq(2,5), method='brunet',
nrun=1,
seed=123456)
library(NMF)
res <- nmfEstimateRank(x, seq(2,5), method='brunet',
nrun=10,
seed=123456)
rV <- randomize(as.matrix(intData))
rV <- randomize(x)
rand <- nmfEstimateRank(rV, seq(2,5), method='brunet', nrun=50, seed=123456)
rand <- nmfEstimateRank(rV, seq(2,5), method='brunet',
nrun=10, seed=123456)
plot(res)
rV
x
library(NMF)
res <- nmfEstimateRank(x, seq(2,5), method='brunet',
nrun=10,
seed=123456)
rV <- randomize(x)
rand <- nmfEstimateRank(rV, seq(2,5),
method='brunet',
nrun=10,
seed=123456)
rV
rand <- nmfEstimateRank(rV[rowSums(rV) > 0,], seq(2,5),
method='brunet',
nrun=10,
seed=123456)
plot(res, rand)
png(filename = here::here("results/2020-04-05/metagenomes_cophenetic_cor.png"),
width = 5, height = 5, res = 300, units = "in")
plot(res, rand)
dev.off()
png(filename = here::here("results/2020-04-05/metagenomes_cophenetic_cor.png"),
width = 6.5, height = 5, res = 300, units = "in")
plot(res, rand)
dev.off()
nmfOut <- nmf(x, rank = 3)
nmfOut
nmfOut <- nmf(x, rank = 3)
wMatrix <- basis(nmfOut)
wMatrix
heatmap(wMatrix)
pathways <- read.csv(here::here("data/2020-04-05/Oman_metags_kos_lcms.csv"))
x <- as.matrix(pathways[,-1])
rownames(x) <- pathways$Function
x <- x[rowSums(x) > 0,]
pathways <- read.csv(here::here("data/2020-04-05/Oman_metags_kos_lcms.csv"))
x <- as.matrix(pathways[,-1])
x
read.csv(here::here("data/2020-04-05/Oman_metags_kos_lcms.csv"))
pathways <- read.csv(here::here("data/2020-04-05/Oman_metags_kos_lcms.csv"))
pathways
as.matrix(pathways[,-1:5])
as.matrix(pathways[,-c(1:5)])
x <- as.matrix(pathways[,-c(1:5)])
rownames(x) <- pathways$Function
x <- x[rowSums(x) > 0,]
x
pathways <- read.csv(here::here("data/2020-04-05/Oman_metags_kos_lcms.csv"))
x <- as.matrix(pathways[,-c(1:5)])
rownames(x) <- pathways$Function
x <- x[rowSums(x) > 0,]
library(NMF)
if(F) {
res <- nmfEstimateRank(x, seq(2,5), method='brunet',
nrun=10,
seed=123456)
rV <- randomize(x)
rand <- nmfEstimateRank(rV[rowSums(rV) > 0,], seq(2,5),
method='brunet',
nrun=10,
seed=123456)
png(filename = here::here("results/2020-04-05/metagenomes_cophenetic_cor.png"),
width = 6.5, height = 5, res = 300, units = "in")
plot(res, rand)
dev.off()
}
library(NMF)
if(T) {
res <- nmfEstimateRank(x, seq(2,5), method='brunet',
nrun=10,
seed=123456)
rV <- randomize(x)
rand <- nmfEstimateRank(rV[rowSums(rV) > 0,], seq(2,5),
method='brunet',
nrun=10,
seed=123456)
png(filename = here::here("results/2020-04-05/metagenomes_cophenetic_cor.png"),
width = 6.5, height = 5, res = 300, units = "in")
plot(res, rand)
dev.off()
}
plot(res, rand)
x
pathways
pathways <- read.csv(here::here("data/2020-04-05/Oman_metags_kos_lcms.csv"))
x <- as.matrix(pathways[,-c(1:5)])
x <- x[rowSums(x) > 0,]
x <- scale(x)
#rownames(x) <- pathways$Function
library(NMF)
if(T) {
res <- nmfEstimateRank(x, seq(2,5), method='brunet',
nrun=10,
seed=123456)
rV <- randomize(x)
rand <- nmfEstimateRank(rV[rowSums(rV) > 0,], seq(2,5),
method='brunet',
nrun=10,
seed=123456)
png(filename = here::here("results/2020-04-05/metagenomes_cophenetic_cor.png"),
width = 6.5, height = 5, res = 300, units = "in")
plot(res, rand)
dev.off()
}
res
res <- nmfEstimateRank(x, seq(2,5), method='brunet',
nrun=10,
seed=123456)
x
pathways <- read.csv(here::here("data/2020-04-05/Oman_metags_kos_lcms.csv"))
x <- as.matrix(pathways[,-c(1:5)])
x <- x[rowSums(x) > 0,]
#rownames(x) <- pathways$Function
library(NMF)
if(T) {
res <- nmfEstimateRank(x, seq(2,5), method='brunet',
nrun=10,
seed=123456)
rV <- randomize(x)
rand <- nmfEstimateRank(rV[rowSums(rV) > 0,], seq(2,5),
method='brunet',
nrun=10,
seed=123456)
png(filename = here::here("results/2020-04-05/metagenomes_cophenetic_cor.png"),
width = 6.5, height = 5, res = 300, units = "in")
plot(res, rand)
dev.off()
}
plot(res, rand)
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
pathways
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
x <- as.matrix(pathways[,-c(1:5)])
x <- x[rowSums(x) > 0,]
#rownames(x) <- pathways$Function
library(NMF)
if(T) {
res <- nmfEstimateRank(x, seq(2,5), method='brunet',
nrun=10,
seed=123456)
rV <- randomize(x)
rand <- nmfEstimateRank(rV[rowSums(rV) > 0,], seq(2,5),
method='brunet',
nrun=10,
seed=123456)
png(filename = here::here("results/2020-04-05/metagenomes_cophenetic_cor.png"),
width = 6.5, height = 5, res = 300, units = "in")
plot(res, rand)
dev.off()
}
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
x <- as.matrix(pathways[,-c(1:5)])
x <- x[rowSums(x) > 0,]
rownames(x) <- pathways$Function
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
x <- as.matrix(pathways[,-c(1:5)])
x <- x[rowSums(x) > 0,]
rownames(x) <- pathways$Function
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
x <- as.matrix(pathways[,-c(1:5)])
x <- x[rowSums(x) > 0,]
rownames(x)
x
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
x <- as.matrix(pathways[,-c(1)])
x <- x[rowSums(x) > 0,]
rownames(x) <- pathways$Function
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
x <- as.matrix(pathways[,-c(1)])
x <- x[rowSums(x) > 0,]
rownames(x) <- pathways$Function
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
x <- as.matrix(pathways[,-1])
x
x <- x[rowSums(x) > 0,]
x
rownames(x) <- pathways$Function
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
x <- as.matrix(pathways[,-1])
rownames(x) <- pathways$Function
x <- x[rowSums(x) > 0,]
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
x <- as.matrix(pathways[,-1])
rownames(x) <- pathways$Function
x <- x[rowSums(x) > 0,]
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
x <- as.matrix(pathways[,-1])
rownames(x) <- pathways$Function
x <- x[rowSums(x) > 0,]
library(NMF)
if(T) {
res <- nmfEstimateRank(x, seq(2,5), method='brunet',
nrun=10,
seed=123456)
rV <- randomize(x)
rand <- nmfEstimateRank(rV[rowSums(rV) > 0,], seq(2,5),
method='brunet',
nrun=10,
seed=123456)
png(filename = here::here("results/2020-04-05/metagenomes_cophenetic_cor.png"),
width = 6.5, height = 5, res = 300, units = "in")
plot(res, rand)
dev.off()
}
plot(res, rand)
library(NMF)
if(T) {
res <- nmfEstimateRank(x, seq(2,5), method='brunet',
nrun=50,
seed=123456)
rV <- randomize(x)
rand <- nmfEstimateRank(rV[rowSums(rV) > 0,], seq(2,5),
method='brunet',
nrun=50,
seed=123456)
png(filename = here::here("results/2020-04-05/metagenomes_cophenetic_cor.png"),
width = 6.5, height = 5, res = 300, units = "in")
plot(res, rand)
dev.off()
}
plot(res, rand)
pathways <- read.csv(here::here("data/2020-04-05/Oman_metags_kos_lcms.csv"))
x <- as.matrix(pathways[,-1])
#rownames(x) <- pathways$Function
x <- x[rowSums(x) > 0,]
pathways <- read.csv(here::here("data/2020-04-05/Oman_metags_kos_lcms.csv"))
x <- as.matrix(pathways[,-c(1:5)])
#rownames(x) <- pathways$Function
x <- x[rowSums(x) > 0,]
library(NMF)
if(T) {
res <- nmfEstimateRank(x, seq(2,5), method='brunet',
nrun=50,
seed=123456)
rV <- randomize(x)
rand <- nmfEstimateRank(rV[rowSums(rV) > 0,], seq(2,5),
method='brunet',
nrun=50,
seed=123456)
png(filename = here::here("results/2020-04-05/metagenomes_cophenetic_cor.png"),
width = 6.5, height = 5, res = 300, units = "in")
plot(res, rand)
dev.off()
}
library(NMF)
if(T) {
res <- nmfEstimateRank(x, seq(2,5), method='brunet',
nrun=100,
seed=123456)
rV <- randomize(x)
rand <- nmfEstimateRank(rV[rowSums(rV) > 0,], seq(2,5),
method='brunet',
nrun=100,
seed=123456)
png(filename = here::here("results/2020-04-05/metagenomes_cophenetic_cor.png"),
width = 6.5, height = 5, res = 300, units = "in")
plot(res, rand)
dev.off()
}
plot(res, rand)
pathways <- read.csv(here::here("data/2020-04-05/Oman_kegg_mapp_lcms.csv"))
x <- as.matrix(pathways[,-c(1)])
rownames(x) <- pathways$Function
x <- x[rowSums(x) > 0,]
library(NMF)
if(T) {
res <- nmfEstimateRank(x, seq(2,5), method='brunet',
nrun=100,
seed=123456)
rV <- randomize(x)
rand <- nmfEstimateRank(rV[rowSums(rV) > 0,], seq(2,5),
method='brunet',
nrun=100,
seed=123456)
png(filename = here::here("results/2020-04-05/metagenomes_cophenetic_cor.png"),
width = 6.5, height = 5, res = 300, units = "in")
plot(res, rand)
dev.off()
}
plot(res, rand)
nmfOut <- nmf(x, rank = 3)
wMatrix <- basis(nmfOut)
heatmap(wMatrix)
nmfOut
keyFeatures <- extractFeatures(nmfOut, method = 0.99)
keyFeatures <- extractFeatures(nmfOut, method = 0.99)
keyFeatures
nmfOut
wMatrix
keyFeatures <- extractFeatures(nmfOut, method = 0.9)
keyFeatures
keyFeatures <- extractFeatures(nmfOut, method = 0.99)
keyFeatures
linkedFactors <- apply(coef(nmfOut), 1, function(row) {
row > 0.1
})
linkedFactors
keyFeatures
wMatrix[keyFeatures[[1]],]
wMatrix[keyFeatures[[2]],]
wMatrix[keyFeatures[[3]],]
heatmap(wMatrix)
linkedFactors
wMatrix[keyFeatures[[1]],]
wMatrix[keyFeatures[[2]],]
wMatrix[keyFeatures[[3]],]
