}
solvent <- doubleCheck[[1]]
spe <- doubleCheck[[2]]
overlap <- solvent | spe
name <- c("Count")
knitr::kable(data.frame(Blank = name, Solvent = sum(solvent), SPE = sum(spe),
Overlap = sum(overlap), Total = length(spe)))
omanFT <- omanFT[!overlap,]
rm(list=setdiff(ls(), c("omanFT", "metadata", "dataCols")))
omanFT
ls
#here("data/2018-11-23/QA_oman_feature_table.txt")
write.table(omanFT)
write.table(omanFT, file = here("data/2018-11-23/QA_oman_feature_table.txt"),row.names = F)
read.table(here("data/2018-11-23/QA_oman_feature_table.txt"))
read.table(here("data/2018-11-23/QA_oman_feature_table.txt"), header = T,
stringsAsFactors = F)
omanFT <- read.table(here("data/2018-11-23/QA_oman_feature_table.txt"), header = T,
stringsAsFactors = F)
omanFT
ncol
ncol(omanFT)
dataCols <- 3:9
dataCols
as.matrix(omanFT[,dataCols]) %>% heatmap()
as.matrix(omanFT[,dataCols]) %>% heatmap()
library(dplyr)
library(here)
omanFT
library(dplyr)
library(here)
omanFT <- read.csv(here("data/2018-11-22/OM17 compound_measurements_10k_blanks.csv"),
header = T,
skip = 4)
metadata <- read.table(here("data/2018-11-22/metadata.txt"),
header = T, sep = " ", stringsAsFactors = F)
metadata <- metadata[-nrow(metadata),]
metadata$Sample_Name <- metadata$Sample_Name %>% sub(":", "", .)
dataCols <- list()
for(i in 1:nrow(metadata)) {
dataCols[[i]] <- grep(metadata$Sample_Name[i],colnames(omanFT))[1]
}
colnames(omanFT)[c(2,5)] <- c("Neutral_Mass", "Retention_Time")
omanFT$Retention_Time <- omanFT$Retention_Time * 60
## consider
omanFT <- omanFT[,c(2,5, unlist(dataCols))]
dataCols <- grep("XS1", colnames(omanFT))
colnames(omanFT)[dataCols] <- metadata$Sample_Type[which(metadata$Sample_Name %in%
colnames(omanFT)[dataCols])]
rm(i)
intensityTable <- omanFT[,dataCols]
x <- sapply(1:ncol(intensityTable), function(x) {
hist(intensityTable[,x], main = colnames(intensityTable)[x], breaks = 250)
})
omanFT[,dataCols] <- log1p(intensityTable)
rm(x, intensityTable)
heat <- omanFT[,dataCols]
blankCols <- grep("blank", colnames(heat), ignore.case = T)
name <- c("Count")
solvent <- heat[,blankCols[1]] > 0
spe <- heat[,blankCols[2]] > 0
overlap <- solvent | spe
knitr::kable(data.frame(Blank = name, Solvent = sum(solvent), SPE = sum(spe),
Overlap = sum(overlap), Total = length(spe)))
heatmap(as.matrix(heat), main = "Distribution of Features Between Samples")
rm(solvent, spe, overlap, name)
blankData <- heat[,blankCols]
sampleData <- heat[,-blankCols]
double <- log1p(2)
doubleCheck <- list()
for(i in seq_along(blankCols)) {
#minVal <- min(blankData[,i][blankData[,i] > 0])
#x <- blankData[,i][blankData[,i] == 0] <- minVal
foldChange <- apply(sampleData, 2, function(x) {
y <- x/blankData[,i]
infIndex <- is.infinite(y)
y[is.nan(y)] <- 0
if(length(infIndex) > 0) {
y[infIndex] <- max(y[!infIndex])
}
y
}) %>% apply(1, max)
hist(log(foldChange), breaks = 100,
main = paste(colnames(blankData)[i], "Features Under Median Sample Intensity"))
abline(v = double, lty = 2)
doubleCheck[[i]] <- foldChange > double
}
omanFT[!overlap,]
message("Difference in Retained Features Between Approaches: ", 2089 - 1809)
solvent <- doubleCheck[[1]]
spe <- doubleCheck[[2]]
overlap <- solvent | spe
name <- c("Count")
omanFT[!overlap,]
omanFT[overlap,]
overlap
solvent
spe
doubleCheck
solvent <- !doubleCheck[[1]]
spe <- !doubleCheck[[2]]
overlap <- solvent | spe
overlap
knitr::kable(data.frame(Blank = name, Solvent = sum(solvent), SPE = sum(spe),
Overlap = sum(overlap), Total = length(spe)))
omanFT <- omanFT[!overlap,]
omanFT
solvent
library(dplyr)
library(here)
omanFT <- read.csv(here("data/2018-11-22/OM17 compound_measurements_10k_blanks.csv"),
header = T,
skip = 4)
metadata <- read.table(here("data/2018-11-22/metadata.txt"),
header = T, sep = " ", stringsAsFactors = F)
metadata <- metadata[-nrow(metadata),]
metadata$Sample_Name <- metadata$Sample_Name %>% sub(":", "", .)
dataCols <- list()
for(i in 1:nrow(metadata)) {
dataCols[[i]] <- grep(metadata$Sample_Name[i],colnames(omanFT))[1]
}
colnames(omanFT)[c(2,5)] <- c("Neutral_Mass", "Retention_Time")
omanFT$Retention_Time <- omanFT$Retention_Time * 60
## consider
omanFT <- omanFT[,c(2,5, unlist(dataCols))]
dataCols <- grep("XS1", colnames(omanFT))
colnames(omanFT)[dataCols] <- metadata$Sample_Type[which(metadata$Sample_Name %in%
colnames(omanFT)[dataCols])]
rm(i)
intensityTable <- omanFT[,dataCols]
x <- sapply(1:ncol(intensityTable), function(x) {
hist(intensityTable[,x], main = colnames(intensityTable)[x], breaks = 250)
})
omanFT[,dataCols] <- log1p(intensityTable)
rm(x, intensityTable)
heat <- omanFT[,dataCols]
blankCols <- grep("blank", colnames(heat), ignore.case = T)
name <- c("Count")
solvent <- heat[,blankCols[1]] > 0
spe <- heat[,blankCols[2]] > 0
solvent
library(dplyr)
library(here)
omanFT <- read.csv(here("data/2018-11-22/OM17 compound_measurements_10k_blanks.csv"),
header = T,
skip = 4)
metadata <- read.table(here("data/2018-11-22/metadata.txt"),
header = T, sep = " ", stringsAsFactors = F)
metadata <- metadata[-nrow(metadata),]
metadata$Sample_Name <- metadata$Sample_Name %>% sub(":", "", .)
dataCols <- list()
for(i in 1:nrow(metadata)) {
dataCols[[i]] <- grep(metadata$Sample_Name[i],colnames(omanFT))[1]
}
colnames(omanFT)[c(2,5)] <- c("Neutral_Mass", "Retention_Time")
omanFT$Retention_Time <- omanFT$Retention_Time * 60
## consider
omanFT <- omanFT[,c(2,5, unlist(dataCols))]
dataCols <- grep("XS1", colnames(omanFT))
colnames(omanFT)[dataCols] <- metadata$Sample_Type[which(metadata$Sample_Name %in%
colnames(omanFT)[dataCols])]
rm(i)
intensityTable <- omanFT[,dataCols]
x <- sapply(1:ncol(intensityTable), function(x) {
hist(intensityTable[,x], main = colnames(intensityTable)[x], breaks = 250)
})
omanFT[,dataCols] <- log1p(intensityTable)
rm(x, intensityTable)
heat <- omanFT[,dataCols]
blankCols <- grep("blank", colnames(heat), ignore.case = T)
name <- c("Count")
solvent <- heat[,blankCols[1]] > 0
spe <- heat[,blankCols[2]] > 0
overlap <- solvent | spe
knitr::kable(data.frame(Blank = name, Solvent = sum(solvent), SPE = sum(spe),
Overlap = sum(overlap), Total = length(spe)))
heatmap(as.matrix(heat), main = "Distribution of Features Between Samples")
rm(solvent, spe, overlap, name)
blankData <- heat[,blankCols]
sampleData <- heat[,-blankCols]
double <- log1p(2)
doubleCheck <- list()
for(i in seq_along(blankCols)) {
#minVal <- min(blankData[,i][blankData[,i] > 0])
#x <- blankData[,i][blankData[,i] == 0] <- minVal
foldChange <- apply(sampleData, 2, function(x) {
y <- x/blankData[,i]
infIndex <- is.infinite(y)
y[is.nan(y)] <- 0
if(length(infIndex) > 0) {
y[infIndex] <- max(y[!infIndex])
}
y
}) %>% apply(1, max)
hist(log(foldChange), breaks = 100,
main = paste(colnames(blankData)[i], "Features Under Median Sample Intensity"))
abline(v = double, lty = 2)
doubleCheck[[i]] <- foldChange > double
}
message("Difference in Retained Features Between Approaches: ", 2089 - 1809)
solvent <- !doubleCheck[[1]]
spe <- !doubleCheck[[2]]
overlap <- solvent | spe
name <- c("Count")
knitr::kable(data.frame(Blank = name, Solvent = sum(solvent), SPE = sum(spe),
Overlap = sum(overlap), Total = length(spe)))
message("Difference in Retained Features Between Approaches: ", 2089 - 1242)
solvent <- !doubleCheck[[1]]
spe <- !doubleCheck[[2]]
overlap <- solvent | spe
name <- c("Count")
knitr::kable(data.frame(Blank = name, Solvent = sum(solvent), SPE = sum(spe),
Overlap = sum(overlap), Total = length(spe)))
omanFT <- omanFT[!overlap,]
rm(list=setdiff(ls(), c("omanFT", "metadata", "dataCols")))
write.table(omanFT,
file = here("data/2018-11-23/QA_oman_feature_table.txt"),
row.names = F)
omanFT <- read.table(here("data/2018-11-23/QA_oman_feature_table.txt"), header = T,
stringsAsFactors = F)
dataCols <- 3:9
as.matrix(omanFT[,dataCols]) %>% heatmap()
heatmap(as.matrix(omanFT[,dataCols]), main = "Feature Distribution After QA")
library(dplyr)
library(here)
omanFT <- read.csv(here("data/2018-11-22/OM17 compound_measurements_10k_blanks.csv"),
header = T,
skip = 4)
metadata <- read.table(here("data/2018-11-22/metadata.txt"),
header = T, sep = " ", stringsAsFactors = F)
metadata <- metadata[-nrow(metadata),]
metadata$Sample_Name <- metadata$Sample_Name %>% sub(":", "", .)
dataCols <- list()
for(i in 1:nrow(metadata)) {
dataCols[[i]] <- grep(metadata$Sample_Name[i],colnames(omanFT))[1]
}
colnames(omanFT)[c(2,5)] <- c("Neutral_Mass", "Retention_Time")
omanFT$Retention_Time <- omanFT$Retention_Time * 60
## consider
omanFT <- omanFT[,c(2,5, unlist(dataCols))]
dataCols <- grep("XS1", colnames(omanFT))
colnames(omanFT)[dataCols] <- metadata$Sample_Type[which(metadata$Sample_Name %in%
colnames(omanFT)[dataCols])]
rm(i)
intensityTable <- omanFT[,dataCols]
x <- sapply(1:ncol(intensityTable), function(x) {
hist(intensityTable[,x], main = colnames(intensityTable)[x], breaks = 250)
})
omanFT[,dataCols] <- log1p(intensityTable)
rm(x, intensityTable)
heat <- omanFT[,dataCols]
blankCols <- grep("blank", colnames(heat), ignore.case = T)
name <- c("Count")
solvent <- heat[,blankCols[1]] > 0
spe <- heat[,blankCols[2]] > 0
overlap <- solvent | spe
knitr::kable(data.frame(Blank = name, Solvent = sum(solvent), SPE = sum(spe),
Overlap = sum(overlap), Total = length(spe)))
heatmap(as.matrix(heat), main = "Distribution of Features Between Samples")
rm(solvent, spe, overlap, name)
omanFT
grepl("blank", colnames(omanFT), ignore.case = T)
!grepl("blank", colnames(omanFT), ignore.case = T)
omanFT <- read.table(here("data/2018-11-23/QA_oman_feature_table.txt"), header = T,
stringsAsFactors = F)
dataCols <- 3:9
dataCols <- 3:7
as.matrix(omanFT[,dataCols]) %>% heatmap()
as.matrix(omanFT[,dataCols]) %>% heatmap(main = "Feature Distribution Between Samples")
plot(omanFT$Neutral_Mass, omanFT$Retention_Time)
plot(omanFT$Retention_Time, omanFT$Neutral_Mass)
library(limma)
omanFT
omanFT[,dataCols] %>% apply(2, function(x) {
x[x > 0]
})
omanFT[,dataCols] %>% apply(2, function(x) {
x > 0
})
overlapTable <- omanFT[,dataCols] %>% apply(2, function(x) {
x > 0
})
vennCounts(overlapTable)
vennDiagram(vennCounts(overlapTable))
library(RColorBrewer)
brewer.pal(5, "Set1")
vennDiagram(vennCounts(overlapTable), circle.col = brewer.pal(5, "Set1"))
rm(overlapTable)
overlapTable <- omanFT[,dataCols] %>% apply(2, function(x) {
x > 0
})
vennDiagram(vennCounts(overlapTable), circle.col = brewer.pal(5, "Set1"))
rm(overlapTable)
princomp(omanFT)
omanFT
princomp(omanFT[,dataCols])
print(princomp(omanFT[,dataCols]))
plot(princomp(omanFT[,dataCols]))
library(ggbiplot)
ggbiplot(princomp(omanFT[,dataCols]))
ggbiplot(princomp(omanFT[,dataCols]), ellipse = T)
ggbiplot(princomp(omanFT[,dataCols]), ellipse = T,obs.scale = 1, var.scale = 1)
omanFT[,dataCols] %>% apply(1, var)
library(dplyr)
library(ggplot2)
library(here)
library(limma)
library(RColorBrewer)
library(ggbiplot)
omanFT[,dataCols] %>% apply(1, var)
omanFT[,dataCols] %>% apply(1, var) %>% hist()
omanFT[,dataCols] %>% apply(1, var) %>% hist(breaks = 100)
overlapTable
omanFT
omanFT[order(omanFT$Neutral_Mass),]
m0z<- omanFT$Neutral_Mass[order(omanFT$Neutral_Mass),]
mz <- omanFT$Neutral_Mass[order(omanFT$Neutral_Mass),]
mz <- omanFT$Neutral_Mass[order(omanFT$Neutral_Mass)]
omanFT[order(omanFT$Neutral_Mass),]
omanFT[order(omanFT$Neutral_Mass),dataCols] %>% apply(1, max)
abs_abu <- omanFT[order(omanFT$Neutral_Mass),dataCols] %>% apply(1, max)
formTable <- data.frame(mOz, abs_abu)
mOz <- omanFT$Neutral_Mass[order(omanFT$Neutral_Mass)]
abs_abu <- omanFT[order(omanFT$Neutral_Mass),dataCols] %>% apply(1, max)
formTable <- data.frame(mOz, abs_abu)
formTable
write.table(formTable, row.names = F)
write.table(formTable, row.names = F, here("data/2018-11-24/formularity_table.txt"))
mOz <- omanFT$Neutral_Mass[order(omanFT$Neutral_Mass)]
abs_abu <- omanFT[order(omanFT$Neutral_Mass),dataCols] %>% apply(1, max)
formTable <- data.frame(mOz, abs_abu)
write.table(formTable, row.names = F, here::here("data/2018-11-24/formularity_table.txt"), sep = "\t")
?write.table
mOz <- omanFT$Neutral_Mass[order(omanFT$Neutral_Mass)]
abs_abu <- omanFT[order(omanFT$Neutral_Mass),dataCols] %>% apply(1, max)
formTable <- data.frame(mOz, abs_abu)
write.table(formTable, row.names = F, here::here("data/2018-11-24/formularity_table.txt"), sep = "\t", quote = F, eol = "\n")
readLines("~/Desktop/Formularity_Program_0/Documents/test_peaks.txt")
readLines("data/2018-11-24/formularity_table.txt")
formTable
write.table(formTable, row.names = F, here::here("data/2018-11-24/formularity_table.txt"), sep = "\t", quote = T, eol = "\n")
readLines("data/2018-11-24/formularity_table.txt")
formTable
formTable <- data.frame(mOz, abs_abu)
write.table(x = formTable, row.names = F,
file = here::here("data/2018-11-24/formularity_table.txt"), quote = T, eol = "\n")
readLines("data/2018-11-24/formularity_table.txt")
write.table(x = formTable, row.names = F,
file = here::here("data/2018-11-24/formularity_table.txt"), eol = "\n")
write.table(x = formTable, row.names = F,
readLines("data/2018-11-24/formularity_table.txt")
formTable
formTable <- data.frame(mz = as.character(mOz), abs_abu)
write.table(x = formTable, row.names = F,
file = here::here("data/2018-11-24/formularity_table.txt"), eol = "\n")
readLines("data/2018-11-24/formularity_table.txt")
formTable
formTable <- data.frame(mz = as.character(mOz), as.character(abs_abu))
write.table(x = formTable, row.names = F,
file = here::here("data/2018-11-24/formularity_table.txt"), eol = "\n")
readLines("data/2018-11-24/formularity_table.txt")
write.table(x = formTable, row.names = F,
file = here::here("data/2018-11-24/formularity_table.txt"), eol = "\n",
quote = F)
readLines("data/2018-11-24/formularity_table.txt")
write.table(x = formTable, row.names = F,
file = here::here("data/2018-11-24/formularity_table.txt"),
quote = F)
readLines("data/2018-11-24/formularity_table.txt")
write.table(x = formTable, row.names = T,
file = here::here("data/2018-11-24/formularity_table.txt"),
quote = F)
write.table(x = formTable, row.names = T,
readLines("data/2018-11-24/formularity_table.txt")
write.table(x = formTable, row.names = T, sep = "\t",
file = here::here("data/2018-11-24/formularity_table.txt"),
quote = F)
readLines("data/2018-11-24/formularity_table.txt")
formTable
abs_abu %>% length()
mOz %>% length()
mOz
Neutral_Mass
omanFT
omanFT
omanFT %>% nrow()`
omanFT %>% nrow()
omanFT %>% nrow()
library(dplyr)
library(here)
omanFT <- read.csv(here("data/2018-11-22/OM17 compound_measurements_10k_blanks.csv"),
header = T,
skip = 4)
metadata <- read.table(here("data/2018-11-22/metadata.txt"),
header = T, sep = " ", stringsAsFactors = F)
metadata <- metadata[-nrow(metadata),]
metadata$Sample_Name <- metadata$Sample_Name %>% sub(":", "", .)
dataCols <- list()
for(i in 1:nrow(metadata)) {
dataCols[[i]] <- grep(metadata$Sample_Name[i],colnames(omanFT))[1]
}
colnames(omanFT)[c(2,5)] <- c("Neutral_Mass", "Retention_Time")
omanFT$Retention_Time <- omanFT$Retention_Time * 60
## consider
omanFT <- omanFT[,c(2,5, unlist(dataCols))]
dataCols <- grep("XS1", colnames(omanFT))
colnames(omanFT)[dataCols] <- metadata$Sample_Type[which(metadata$Sample_Name %in%
colnames(omanFT)[dataCols])]
rm(i)
intensityTable <- omanFT[,dataCols]
x <- sapply(1:ncol(intensityTable), function(x) {
hist(intensityTable[,x], main = colnames(intensityTable)[x], breaks = 250)
})
omanFT[,dataCols] <- log1p(intensityTable)
rm(x, intensityTable)
heat <- omanFT[,dataCols]
blankCols <- grep("blank", colnames(heat), ignore.case = T)
name <- c("Count")
solvent <- heat[,blankCols[1]] > 0
spe <- heat[,blankCols[2]] > 0
overlap <- solvent | spe
knitr::kable(data.frame(Blank = name, Solvent = sum(solvent), SPE = sum(spe),
Overlap = sum(overlap), Total = length(spe)))
heatmap(as.matrix(heat), main = "Distribution of Features Between Samples")
rm(solvent, spe, overlap, name)
blankData <- heat[,blankCols]
sampleData <- heat[,-blankCols]
double <- log1p(2)
doubleCheck <- list()
for(i in seq_along(blankCols)) {
#minVal <- min(blankData[,i][blankData[,i] > 0])
#x <- blankData[,i][blankData[,i] == 0] <- minVal
foldChange <- apply(sampleData, 2, function(x) {
y <- x/blankData[,i]
infIndex <- is.infinite(y)
y[is.nan(y)] <- 0
if(length(infIndex) > 0) {
y[infIndex] <- max(y[!infIndex])
}
y
}) %>% apply(1, max)
hist(log(foldChange), breaks = 100,
main = paste(colnames(blankData)[i], "Features Under Median Sample Intensity"))
abline(v = double, lty = 2)
doubleCheck[[i]] <- foldChange > double
}
overlap
omanFT
omanFT %>% View()
omanFT <- read.csv(here("data/2018-11-22/OM17 compound_measurements_10k_blanks.csv"),
header = T,
skip = 4)
metadata <- read.table(here("data/2018-11-22/metadata.txt"),
header = T, sep = " ", stringsAsFactors = F)
metadata <- metadata[-nrow(metadata),]
metadata$Sample_Name <- metadata$Sample_Name %>% sub(":", "", .)
dataCols <- list()
for(i in 1:nrow(metadata)) {
dataCols[[i]] <- grep(metadata$Sample_Name[i],colnames(omanFT))[1]
}
colnames(omanFT)[c(2,5)] <- c("Neutral_Mass", "Retention_Time")
omanFT$Retention_Time <- omanFT$Retention_Time * 60
## consider
omanFT <- omanFT[,c(2,5, unlist(dataCols))]
dataCols <- grep("XS1", colnames(omanFT))
colnames(omanFT)[dataCols] <- metadata$Sample_Type[which(metadata$Sample_Name %in%
colnames(omanFT)[dataCols])]
rm(i)
omanFT %>% View()
omanFT <- read.csv(here("data/2018-11-22/OM17 compound_measurements_10k_blanks.csv"),
header = T,
skip = 4)
omanFT %>% View()
formTable
library(dplyr)
library(ggplot2)
library(here)
library(limma)
library(RColorBrewer)
library(ggbiplot)
omanFT <- read.table(here::here("data/2018-11-23/QA_oman_feature_table.txt"), header = T,
stringsAsFactors = F)
dataCols <- 3:7
as.matrix(omanFT[,dataCols]) %>% heatmap(main = "Feature Distribution Between Samples")
overlapTable <- omanFT[,dataCols] %>% apply(2, function(x) {
x > 0
})
vennDiagram(vennCounts(overlapTable), circle.col = brewer.pal(5, "Set1"))
rm(overlapTable)
mOz <- omanFT$Neutral_Mass[order(omanFT$Neutral_Mass)]
abs_abu <- omanFT[order(omanFT$Neutral_Mass),dataCols] %>% apply(1, max)
formTable <- data.frame(mz = as.character(mOz), as.character(abs_abu), stringsAsFactors = F)
formTable <- data.frame(mz = as.character(mOz), as.character(abs_abu), stringsAsFactors = F)
is.na(formTable$mz)
sum(is.na(formTable$mz))
sum(!is.na(formTable$mz))
formTable[!is.na(formTable$mz),]
nonNaFormTable <- formTable[!is.na(formTable$mz),]
write.table(x = nonNaFormTable, row.names = F, sep = "\t",
file = here::here("data/2018-11-24/formularity_table.txt"),
quote = F)
readLines("data/2018-11-24/formularity_table.txt")
formTable <- data.frame(mz = as.character(mOz), abs_abu = as.character(abs_abu), stringsAsFactors = F)
nonNaFormTable <- formTable[!is.na(formTable$mz),]
write.table(x = nonNaFormTable, row.names = F, sep = "\t",
file = here::here("data/2018-11-24/formularity_table.txt"),
quote = F)
readLines("data/2018-11-24/formularity_table.txt")
omanFT <- read.csv(here("data/2018-11-22/OM17 compound_measurements_10k_blanks.csv"),
header = T,
skip = 4)
omanFT
